---
import Layout from "../layouts/Layout.astro";
import { supabase } from "../lib/supabase";
import { Card, CardHeader, CardTitle, CardContent } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Plus, Calendar } from "lucide-react";

export const prerender = false;

const { data: intentions, error } = await supabase
	.from("intentions")
	.select("*")
	.order("created_at", { ascending: false });
---

<Layout title="Różaniec - Lista Intencji">
	<div
		class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8 gap-4 animate-in fade-in slide-in-from-bottom-4 duration-700 delay-150"
	>
		<h2
			class="text-2xl md:text-3xl font-semibold tracking-tight text-black"
		>
			Aktywne intencje
		</h2>
		<a
			href="/create-intention"
			class="inline-flex w-full sm:w-auto items-center justify-center whitespace-nowrap rounded-full text-base font-medium transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary/95 text-primary-foreground shadow-lg hover:shadow-primary/25 hover:bg-primary h-12 px-6 active:scale-95"
		>
			<Plus className="w-5 h-5 mr-2" />
			Utwórz nową
		</a>
	</div>

	{
		error ? (
			<div class="text-red-500 glass p-6 rounded-2xl">
				Błąd przy pobieraniu intencji z bazy danych: {error.message}
			</div>
		) : intentions?.length === 0 ? (
			<div class="text-center py-20 px-4 glass rounded-3xl border border-black/5">
				<h3 class="text-lg font-medium text-black mb-2">
					Brak aktywnych intencji
				</h3>
				<p class="text-muted-foreground">
					Rozpocznij tworząc nową listę modlitewną dla Twojej grupy.
				</p>
			</div>
		) : (
			<div class="grid grid-cols-1 sm:grid-cols-2 gap-5 md:gap-6">
				{intentions?.map((intention, index) => (
					<a
						href={`/intention/${intention.id}`}
						class="block group outline-none"
						style={`animation-delay: ${200 + index * 100}ms`}
					>
						<Card className="glass h-full border-white/40 group-hover:border-white/60 transition-all duration-300 group-hover:shadow-xl group-hover:shadow-black/5 group-hover:-translate-y-1 group-focus-visible:ring-2 group-focus-visible:ring-primary rounded-3xl p-1 relative overflow-hidden">
							<div class="absolute inset-0 bg-gradient-to-br from-white/30 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500 rounded-3xl" />
							<CardHeader className="pb-3 px-5 pt-5 relative z-10">
								<div class="flex flex-col sm:flex-row justify-between items-start gap-3">
									<CardTitle className="text-xl font-semibold leading-tight text-black group-hover:text-primary transition-colors">
										{intention.title}
									</CardTitle>
									<Badge
										variant={
											intention.status === "active"
												? "default"
												: "secondary"
										}
										className={`rounded-full px-3 py-1 line-clamp-1 shrink-0 font-medium ${
											intention.status === "active"
												? "bg-primary/10 text-primary hover:bg-primary/20 border-primary/10 shadow-none"
												: ""
										}`}
									>
										{intention.status === "active"
											? "W trakcie"
											: "Zakończona"}
									</Badge>
								</div>
							</CardHeader>
							<CardContent className="px-5 pb-5 relative z-10">
								<div class="text-sm font-medium text-muted-foreground flex items-center gap-1.5 bg-black/5 w-fit px-3 py-1.5 rounded-full">
									<Calendar className="w-4 h-4 opacity-70" />
									Start:{" "}
									<span class="text-black ml-0.5">
										{new Date(
											intention.start_date
										).toLocaleDateString("pl-PL")}
									</span>
								</div>
							</CardContent>
						</Card>
					</a>
				))}
			</div>
		)
	}
</Layout>
