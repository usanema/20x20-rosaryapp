---
import Layout from "../layouts/Layout.astro";
import { supabase } from "../lib/supabase";
import { Card, CardHeader, CardTitle, CardContent } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Plus, Calendar } from "lucide-react";

export const prerender = false;

const { data: intentions, error } = await supabase
	.from("intentions")
	.select("*")
	.order("created_at", { ascending: false });
---

<Layout title="Różaniec - Lista Intencji">
	<div class="flex justify-between items-center mb-8">
		<h2 class="text-2xl font-semibold tracking-tight text-black">
			Aktywne intencje
		</h2>
		<a
			href="/create-intention"
			class="inline-flex items-center justify-center whitespace-nowrap rounded-full text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground shadow hover:bg-primary/90 h-10 px-5 transition-transform active:scale-95"
		>
			<Plus className="w-4 h-4 mr-2" />
			Utwórz nową
		</a>
	</div>

	{
		error ? (
			<div class="text-red-500 glass p-6 rounded-2xl">
				Błąd przy pobieraniu intencji z bazy danych: {error.message}
			</div>
		) : intentions?.length === 0 ? (
			<div class="text-center py-20 px-4 glass rounded-3xl border border-black/5">
				<h3 class="text-lg font-medium text-black mb-2">
					Brak aktywnych intencji
				</h3>
				<p class="text-muted-foreground">
					Rozpocznij tworząc nową listę modlitewną dla Twojej grupy.
				</p>
			</div>
		) : (
			<div class="grid grid-cols-1 md:grid-cols-2 gap-5">
				{intentions?.map((intention) => (
					<a
						href={`/intention/${intention.id}`}
						class="block group transition-transform active:scale-95 duration-200"
					>
						<Card className="glass h-full border-black/5 hover:border-black/10 transition-colors shadow-sm hover:shadow-md cursor-pointer rounded-2xl p-2">
							<CardHeader className="pb-3 px-4 pt-4">
								<div class="flex justify-between items-start gap-4">
									<CardTitle className="text-xl font-medium leading-tight text-black">
										{intention.title}
									</CardTitle>
									<Badge
										variant={
											intention.status === "active"
												? "default"
												: "secondary"
										}
										className="rounded-full px-2.5 py-0.5 line-clamp-1 shrink-0 font-medium"
									>
										{intention.status === "active"
											? "W trakcie"
											: "Zakończona"}
									</Badge>
								</div>
							</CardHeader>
							<CardContent className="px-4 pb-4">
								<div class="text-sm font-medium text-muted-foreground flex items-center gap-1.5">
									<Calendar className="w-4 h-4 opacity-70" />
									Od:{" "}
									{new Date(
										intention.start_date
									).toLocaleDateString("pl-PL")}
								</div>
							</CardContent>
						</Card>
					</a>
				))}
			</div>
		)
	}
</Layout>
